import 'package:intl/intl.dart';

import '../models/log/daily_log_params.dart';
import '../models/log/interval_log_params.dart';
import 'communication_enums.dart';
import 'functions.dart';

const defaultAccessCode = '21213';

// Timeout in milliseconds
const sendCommandTimeoutInMs = 5;
// NOTE: Some AdEM may take longer
const wakeUpTimeoutInMs = 3000;
// NOTE: Some AdEM may take longer
const connectTimeoutInMs = 3000;
const disconnectTimeoutInMs = 1500;
const disconnectLogTimeoutInMs = 10000;
// NOTE: Some parameters may take longer
const readParamTimeoutInMs = 10000;
const writeParamTimeoutInMs = 3000;
const readLogTimeoutInMs = 15000;
const readDongleTimeoutInMs = 3000;
const readBattTimeoutInMs = 10000;
const retryMs = 30000;
const retryDelay = 500;

// Timeout in seconds
const ademConnTimeoutInSec = 7200;

// AdEM Key
const maxBytesDf = 128;
const serviceIdDf = '6e400001-b5a3-f393-e0a9-e50e24dcca9e';
const readCharacteristicDf = '6e400003-b5a3-f393-e0a9-e50e24dcca9e';
const writeCharacteristicDf = '6e400002-b5a3-f393-e0a9-e50e24dcca9e';

// Air Console
const maxBytesAc = 20;
const serviceIdAc = '0f1e4b13-16d2-4396-bf25-000000000000';
const readCharacteristicAc = '0f1e4b13-16d2-4396-bf25-000000000001';
const writeCharacteristicAc = '0f1e4b13-16d2-4396-bf25-000000000001';

// Date time formats
final unitDateFmt = DateFormat('dd MM yy');
final unitTimeFmt = DateFormat('HH mm ss');
final qLogDateFmt = DateFormat('MM yy');

// No log pre-defined messages
const noLogPm = [
  PMessage.noIntervalLog,
  PMessage.noEventLog,
  PMessage.noAlarmOrDailyLog,
  PMessage.noQRLog,
  PMessage.noDpLog,
];

// Error pre-defined messages
const errorPm = [
  PMessage.formatError,
  PMessage.timeOutError,
  PMessage.frameError,
  PMessage.crcError,
  PMessage.incorrectInstrumentAccessCode,
  PMessage.incorrectCommandCode,
  PMessage.incorrectItemNumber,
  PMessage.invalidEnquiry,
  PMessage.tooManyAuditTrailRequests,
  PMessage.readOnlyMode,
  PMessage.eventLogLocked,
  PMessage.agaConfigRefuse,
  PMessage.unknown,
];

// Disconnect success pre-defined messages
const discSuccessPm = [
  PMessage.acknowledge,
  PMessage.timeOutError,
  PMessage.incorrectInstrumentAccessCode,
];

// Unit convert offset
const kpaToPsiOffset = 0.145038;
const kpaToBarOffset = 0.01;
const kpaToInH2oOffset = 4.018598072;
const cToFScale = 1.8;
const cToFOffset = 32.0;
// Note: 3 point dp calibration offset is divided/multiped by 100 (Related to limit)
const dpCalibOffset = 100.0;

// Unavailable params -- AdEM s
const Set<int> unavailableParamsAdemS = {
  8,
  9,
  10,
  11,
  13,
  14,
  26,
  27,
  28,
  53,
  54,
  55,
  63,
  64,
  65,
  87,
  98,
  110,
  111,
  112,
  116,
  47,
  137,
  138,
  147,
  301,
  302,
  303,
  304,
  305,
  306,
  307,
  308,
  309,
  310,
  311,
  312,
  778,
  811,
  821,
  860,
  988,
};

// Unavailable params -- AdEM t
const Set<int> unavailableParamsAdemT = {
  8,
  9,
  10,
  11,
  13,
  14,
  54,
  55,
  63,
  87,
  98,
  110,
  111,
  112,
  116,
  47,
  137,
  138,
  147,
  301,
  302,
  303,
  304,
  305,
  306,
  307,
  308,
  309,
  310,
  311,
  312,
  778,
  811,
  821,
  860,
};

// Unavailable params -- AdEM tq
const Set<int> unavailableParamsAdemTq = {
  8,
  9,
  10,
  11,
  13,
  54,
  55,
  63,
  87,
  88,
  98,
  110,
  112,
  116,
  47,
  137,
  138,
  140,
  142,
  147,
  285,
  286,
  287,
  289,
  290,
  291,
  778,
  781,
  782,
  811,
  821,
  833,
  835,
  837,
  838,
  839,
};

// Unavailable params -- Universal T
const Set<int> unavailableParamsUniversalT = {
  8,
  9,
  10,
  11,
  13,
  14,
  53,
  54,
  55,
  63,
  87,
  98,
  110,
  111,
  112,
  116,
  47,
  137,
  138,
  140,
  142,
  285,
  286,
  287,
  289,
  290,
  291,
  778,
  781,
  782,
  811,
  821,
  833,
  835,
  837,
  838,
  839,
  860,
  861,
  862,
  863,
  864,
  865,
  866,
  867,
  868,
  869,
  870,
  871,
  872,
  877,
  980,
  981,
  989,
  990,
  991,
  992,
  996,
};

// Unavailable params -- AdEM ptz
const Set<int> unavailableParamsAdemPtz = {
  829,
  833,
  835,
  837,
  838,
  839,
  842,
  843,
  844,
  853,
  854,
  855,
  857,
  858,
  859,
  860,
  861,
  862,
  863,
  864,
  865,
  866,
  867,
  868,
  869,
  870,
  871,
  872,
  877,
  980,
  981,
  988,
  989,
  990,
  991,
  992,
  996,
};

// Unavailable params -- AdEM ptz-r
const Set<int> unavailableParamsAdemPtzr = {
  768,
  829,
  833,
  835,
  837,
  838,
  839,
  842,
  843,
  844,
  853,
  854,
  855,
  857,
  858,
  859,
  860,
  861,
  862,
  863,
  864,
  865,
  866,
  867,
  868,
  869,
  870,
  871,
  872,
  877,
  980,
  981,
  989,
  990,
  991,
  992,
  996,
};

// Available custom display params -- AdEM s
Set<int> customDisplayParamsAdemS(String firmwareVersion) => {
  0,
  2,
  // 34,
  43,
  44,
  48,
  59,
  61,
  113,
  115,
  122,
  183,
  184,
  198,
  62,
  201,
  203,
  204,
  209,
  223,
  224,
  255,
  274,
  275,
  767,
  768,
  769,
  772,
  774,
  775,
  776,
  777,
  780,
  806,
  816,
  817,
  828,
  834,
  840,
  if (meetsMinFirmwareVersion(firmwareVersion, minMajor: 'D', minMinor: 6)) 986,
  995,
};

// Available custom display params -- AdEM t
Set<int> customDisplayParamsAdemT(String firmwareVersion) => {
  0,
  2,
  26,
  34,
  43,
  44,
  45,
  48,
  59,
  61,
  98,
  113,
  115,
  122,
  183,
  184,
  198,
  62,
  201,
  203,
  204,
  209,
  223,
  224,
  255,
  274,
  275,
  767,
  768,
  769,
  772,
  773,
  774,
  775,
  776,
  777,
  780,
  783,
  784,
  806,
  816,
  817,
  828,
  834,
  840,
  if (meetsMinFirmwareVersion(firmwareVersion, minMajor: 'D', minMinor: 6)) 986,
  995,
};

// Available custom display params -- AdEM tq
const Set<int> customDisplayParamsAdemTq = {
  0,
  2,
  13,
  14,
  26,
  34,
  43,
  44,
  45,
  48,
  53,
  59,
  61,
  113,
  115,
  122,
  183,
  184,
  198,
  62,
  201,
  203,
  204,
  209,
  223,
  224,
  255,
  274,
  275,
  767,
  768,
  769,
  772,
  773,
  774,
  775,
  776,
  777,
  780,
  783,
  784,
  795,
  806,
  816,
  817,
  828,
  834,
  840,
  853,
  854,
  855,
  856,
  857,
  858,
  860,
  986,
  995,
};

// Available custom display params -- Universal T
Set<int> customDisplayParamsUniversalT(String firmwareVersion) => {
  0,
  2,
  14,
  26,
  34,
  43,
  44,
  45,
  48,
  61,
  113,
  115,
  122,
  183,
  184,
  198,
  62,
  201,
  203,
  204,
  209,
  223,
  224,
  255,
  274,
  275,
  767,
  768,
  769,
  772,
  773,
  774,
  775,
  776,
  777,
  780,
  795,
  806,
  816,
  817,
  828,
  834,
  840,
  if (meetsMinFirmwareVersion(firmwareVersion, minMajor: 'D', minMinor: 6)) 986,
};

// Available custom display params -- AdEM ptz
Set<int> customDisplayParamsAdemPtz(String firmwareVersion) => {
  0,
  2,
  8,
  13,
  14,
  26,
  34,
  43,
  44,
  45,
  48,
  53,
  54,
  55,
  59,
  61,
  113,
  115,
  116,
  47,
  122,
  137,
  138,
  183,
  184,
  198,
  62,
  201,
  203,
  204,
  209,
  223,
  224,
  255,
  274,
  275,
  767,
  768,
  769,
  772,
  773,
  774,
  775,
  776,
  777,
  780,
  781,
  782,
  783,
  784,
  795,
  806,
  811,
  816,
  817,
  828,
  834,
  840,
  if (meetsMinFirmwareVersion(firmwareVersion, minMajor: 'D', minMinor: 6)) 986,
  995,
};

// Available custom display params -- AdEM ptz-r
const Set<int> customDisplayParamsAdemPtzr = {
  0,
  2,
  8,
  13,
  14,
  26,
  34,
  43,
  44,
  45,
  48,
  53,
  54,
  55,
  59,
  61,
  98,
  113,
  115,
  116,
  47,
  122,
  137,
  138,
  183,
  184,
  198,
  62,
  201,
  203,
  204,
  209,
  223,
  224,
  255,
  274,
  275,
  767,
  769,
  772,
  773,
  774,
  775,
  776,
  777,
  780,
  781,
  782,
  783,
  784,
  795,
  811,
  816,
  817,
  828,
  834,
  840,
  986,
};

// Seal protected params
const Set<int> sealProtectedParams = {
  0,
  2,
  13,
  34,
  87,
  90,
  92,
  109,
  110,
  111,
  112,
  122,
  123,
  138,
  147,
  62,
  768,
  790,
  791,
  792,
  793,
  794,
  795,
  796,
  797,
  798,
  799,
  800,
  801,
  802,
  803,
  804,
  805,
  823,
  841,
  845,
  994,
};

// Available daily log params -- AdEM s
const dailyLogParamsAdemS = DailyLogParams(false, false, false, false, false);

// Available daily log params -- AdEM t
const dailyLogParamsAdemT = DailyLogParams(false, true, false, false, false);

// Available daily log params -- AdEM tq
const dailyLogParamsAdemTq = DailyLogParams(false, true, true, true, true);

// Available daily log params -- Universal T
const dailyLogParamsUniversalT = DailyLogParams(
  false,
  true,
  false,
  false,
  false,
);

// Available daily log params -- AdEM ptz
const dailyLogParamsAdemPtz = DailyLogParams(true, true, false, false, false);

// Available daily log params -- AdEM ptz-r
const dailyLogParamsAdemPtzr = DailyLogParams(true, true, false, false, false);

// Available interval log params -- AdEM s
const intervalLogParamsAdemS = IntervalLogParams(
  false,
  false,
  false,
  false,
  false,
  false,
  false,
  false,
  false,
  false,
  false,
  false,
  false,
  false,
  false,
  false,
  IntervalLogAlarmParams(
    false,
    false,
    false,
    false,
    false,
    false,
    false,
    false,
  ),
);

// Available interval log params -- AdEM t
const intervalLogParamsAdemT = IntervalLogParams(
  false,
  true,
  false,
  false,
  false,
  false,
  false,
  false,
  false,
  false,
  false,
  false,
  false,
  false,
  false,
  false,
  IntervalLogAlarmParams(false, false, false, true, true, true, false, false),
);

// Available interval log params -- AdEM tq
const intervalLogParamsAdemTq = IntervalLogParams(
  false,
  true,
  true,
  true,
  false,
  false,
  false,
  false,
  true,
  true,
  true,
  true,
  true,
  true,
  true,
  true,
  IntervalLogAlarmParams(false, false, false, true, true, true, true, true),
);

// Available interval log params -- Universal T
const intervalLogParamsUniversalT = IntervalLogParams(
  false,
  true,
  true,
  true,
  false,
  false,
  false,
  false,
  true,
  true,
  true,
  true,
  true,
  true,
  true,
  true,
  IntervalLogAlarmParams(false, false, false, true, true, true, false, false),
);

// Available interval log params -- AdEM ptz
const intervalLogParamsAdemPtz = IntervalLogParams(
  true,
  true,
  true,
  true,
  true,
  true,
  true,
  true,
  true,
  true,
  true,
  true,
  true,
  true,
  true,
  true,
  IntervalLogAlarmParams(true, true, true, true, true, true, true, true),
);

// Available interval log params -- AdEM ptz-r
const intervalLogParamsAdemPtzr = IntervalLogParams(
  true,
  true,
  true,
  true,
  true,
  true,
  true,
  true,
  true,
  true,
  true,
  true,
  true,
  true,
  true,
  true,
  IntervalLogAlarmParams(true, true, true, true, true, true, true, true),
);
